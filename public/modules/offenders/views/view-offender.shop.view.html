<section data-ng-controller="OffendersController" data-ng-init="findOne2()">

<style>
.col-md-4, .col-md-8{
    padding: 10px;

}
.form-inline{
    padding: 17px;

}
fieldset{
    padding: 3px;
}
.main-body{
	background-color: #555;
	font-size: 1.25em;
}

/* CSS REQUIRED */
.state-icon {
    left: -5px;
}
.list-group-item-primary {
    color: rgb(255, 255, 255);
    background-color: rgb(66, 139, 202);
}

/* DEMO ONLY - REMOVES UNWANTED MARGIN */
.well .list-group {
    margin-bottom: 0px;
}
.strike {
  text-decoration: line-through;
}
.done-true  {
    color: #777777;
    text-decoration: line-through;
}
</style>
	<div class="main-body">
	    <div class="container">

	    <div class="text-center bg-danger" data-ng-show="pastDue">
	    	<h3>Past Due</h3>

	    	</div>

	    	<div ng-show="workorder.completed" class="text-center bg-danger">
	    	<h3>Order Complete</h3>
	    	</div>
		<div class="panel panel-primary">
	       
	    	<div class="col-md-4">
	            <div class="panel panel-profile">
	                <fieldset>
	                    <div class="panel-heading bg-primary clearfix">
	                                <!-- <a href="" class="pull-left profile">
	                                    <img alt="" src="images/g1.jpg" class="img-circle img80_80">
	                                </a> -->
	                                <!-- <div class="pull-left profile">
	                                    <i class="fa fa-users text-large stat-icon"></i>
	                                </div> -->
	                                <!-- <span class="pull-left box-icon rounded text-large">
	                                    <i class="fa fa-check"></i>
	                                </span> -->
	                                <h4>Service Checklist</h4>
	                              
	                    </div>
	                    <div class="media">
	                        <div class="media-body">



	                                        <ul class="list-unstyled list-info">
	                                  
	                                            <li class="done-{{todo.done}}" data-ng-repeat="stuff in checklist track by $index" >
	                                            <input type="checkbox" data-ng-model="todo.done" data-ng-click="clicked(stuff.click, $index)" />
	                                           
             										 <span class="{{stuff.strike}}" >{{stuff.item}} </span>
	                                            </li>
	                                        </ul>
	                        </div>
	                    </div>
	        		</fieldset>
	               
	            </div>
	        </div> 

	        <div class="col-md-8">
	            <div class="panel panel-profile">
	                <fieldset>
	                    <div class="panel-heading bg-primary clearfix">
	                                <!-- <a href="" class="pull-left profile">
	                                    <img alt="" src="images/g1.jpg" class="img-circle img80_80">
	                                </a> -->
	                                <!-- <div class="pull-left profile">
	                                    <i class="fa fa-users text-large stat-icon"></i>
	                                </div> -->
	                                <!-- <span class="pull-left box-icon rounded text-large">
	                                    <i class="fa fa-check"></i>
	                                </span> -->
	                                <h4>Customer Information</h4>
	                              
	                    </div>
	                    <div class="media">
	                        <div class="media-body">
	                                        <ul class="list-unstyled list-info">
	                                            <li>
	                                                
	                                                <label>Name</label>
	                                                {{offender.firstName}} {{offender.lastName}}
	                                            </li>
	                                            <li>
	                                               
	                                                <label>Email</label>
	                                                {{offender.offenderEmail || 'N/A'}}
	                                            </li>
	                                            <li>
	                                               <!--  <span class="icon glyphicon glyphicon-earphone"></span> -->
	                                                <label>Phone</label>
	                                                {{offender.mainPhone | tel}}
	                                            </li>
	                                            <li>
	                                               <!--  <span class="icon glyphicon glyphicon-envelope"></span> -->
	                                                <label>Alternate</label>
	                                                 {{offender.altPhone | tel}} 
	                                            </li>
	                                               <li>
	                                               <!--  <span class="icon glyphicon glyphicon-envelope"></span> -->
	                                                <label>Date of Birth</label>
	                                                <span style="text-transform: capitalize"> {{offender.dobMO}}/{{offender.dobDAY}}/{{offender.dobYR}}</span>
	                                            </li>

	                                        </ul>
	                        </div>
	                    </div>
	        		</fieldset>
	               
	            </div>
	        </div> 



	                    </fieldset>
	                </form>
	            

	            </div>
	             
	      
	        <div class=" clearfix"></div>
	    	
		<div class="panel panel-primary">
	<div class="panel panel-profile">
				         <accordion close-others="oneAtATime">
				            <accordion-group>
				            <accordion-heading>
				            	<div class="col-md-5">

				            Work Order History
				            </div>

				            	<div class="col-md-4 text-danger">

				           <span data-ng-show="offender.pendingWorkOrder">
				            Pending Work Order
				            </span>
				            </div>

				             	<div class="col-md-3" >
				             	
				          <a class="btn btn-primary btn-xs pull-right" style="color: #fff;" data-ng-click="open()">
				<span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New Work Order
			</a>
				            </div>

				             <div class=" clearfix"></div>


				            </accordion-heading>
				     			         <table class="table table-bordered table-striped table-responsive" data-ng-init="getWorkOrders()">
	                <thead>
	                    <tr>
	                    <th>
	                            <div class="th">
	                                Date
	                             </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Type
	                             </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Shop 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Charge 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Status 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Notes 
	                        </div>
	                        </th>

	                                  </tr> 
	                </thead>
	                <tbody>
	                    <tr data-ng-repeat="wo in workorders">
	                    <td>{{wo.apptDate | date: 'short'}}</td>
	                    <td>{{wo.type}}</td>
	                    <td>{{wo.serviceCenter}}</td>
	                    <td>${{wo.amount | number: '2'}}</td>
	                    <td>{{wo.status}}</td>
	                    <td>{{wo.orderNotes}}</td>
	                    
	                    </tr>

	                  

	                    </tbody>
	                    </table>

				    </accordion-group>
				    <accordion-group is-open="status.open">
				      
				            <accordion-heading>
				            	<div class="col-md-5">

				            Payment History
				            </div>

				            	<div class="col-md-4 text-danger" >
				            	<span data-ng-show="pastDue">
				            Past Due Balance
				            </span>
				            </div>

				             	<div class="col-md-3" >
				             	
				          <a class="btn btn-primary btn-xs pull-right" style="color: #fff;" data-ng-click="openPmt()">
				<span class="glyphicon glyphicon-usd" aria-hidden="true"></span> Make Payment
			</a>

				            </div>
				             <div class=" clearfix"></div>
				        </accordion-heading>

				         <table class="table table-bordered table-striped table-responsive" data-ng-init="getPayments()">
	                <thead>
	                    <tr>
	                       <th>
	                            <div class="th">
	                                Date Created
	                             </div>
	                        </th>
	                    <th>
	                            <div class="th">
	                               Due Date
	                             </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Fee Type
	                             </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Payment Type 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Amount 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Status
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Notes 
	                        </div>
	                        </th>

	                                  </tr> 
	                </thead>
	                <tbody>
	                    <tr data-ng-click="getPmtDetail($index)" data-ng-repeat="pmt in payments track by $index">
	                    <td>{{pmt.created | date: 'MM/dd/yyyy'}}</td>
	                     <td>{{pmt.dueDate | date: 'MM/dd/yyyy'}}</td>
	                    <td>{{pmt.pmtType}}</td>
	                    <td>{{pmt.pmtOpt}}</td>
	                    <td>${{pmt.amount}}</td>
	                    <td>{{pmt.status}}</td>
	                    <td>{{pmt.notes}}</td>
	                    </tr>



	                    </tbody>
	                    </table>





				    </accordion-group>
				  </accordion>
	      		</div>
	      		</div>


	                    </fieldset>
	                </form>
	            

	            </div>
	             
	        </div> 



    <script type="text/ng-template" id="myModalContent.html">
       
        <div class="modal-header">

            New Work Order for {{offender.firstName}} {{offender.lastName}}
        </div>
        <div class="modal-body">
      
        
         <label>Work Order Type</label>
        	  <select class="form-control" data-ng-model="chosen" name="chosen" data-ng-options="item for item in items" data-ng-change="changeType()"></select>
        	
<br>
<span data-ng-show="chosen==='New Install'">
         <label>Install Fee</label>
        	  <input type="text" data-ng-model="installFee"  id="installFee" class="form-control" placeholder="80" >
        	<br>
           <label>Term of Service</label>
        	  <select class="form-control" data-ng-model="term" name="term" data-ng-options="term for term in termoptions"> <option value=""></option></select>
<br> 

</span>
        	   <label>Submitting To</label>
        	  <select class="form-control" data-ng-model="sendTo" name="sendTo" data-ng-options="sendto for sendto in sendToOptions" data-ng-change="changeWho()"> <option value=""></option></select>
<br>
				<span data-ng-show="!whomCus">
				<label>Recipient Name</label>
        	    <input type="text" data-ng-model="toWhoName"  id="toWhoName" class="form-control" placeholder="Name" >
        	    <br></span>



				<label>Service Center</label>
				<select class="form-control" data-ng-model="serviceCenter" name="Shops" data-ng-options="shop as (shop.name+' - '+shop.address+' '+shop.city+', '+shop.state) for shop in shops" data-ng-change="changeSvcCenter()"></select>
        	   

<br>
        	   <label>Email Address</label>
        	    <input type="text" data-ng-model="emailAddress"  id="emailAddress" class="form-control" placeholder="Email Address" >

<br>
        	    <label>Email Subject</label>
        	    <input type="text" data-ng-model="emailSubject"  id="emailSubject" class="form-control" placeholder="{{chosen}} Authorization" >
<br>
        	    <label>Email Text</label>
        	    <textarea type="text" data-ng-model="emailText"  id="emailText" class="form-control" placeholder="Hi {{offender.firstName}}..." >

        	    </textarea>
                                <br>
        	    <label>Email Signature</label>
        	   <br>
        	    {{authentication.user.displayName}}<br/>
        	     {{authentication.user.telephone}}<br/>
        	      {{authentication.user.email}}<br/>
        	      


        </div>
        <div class="modal-footer">
            <button class="btn btn-primary"  ng-click="ok()">Send Form</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </script>


    <div ng-show="selected">Selection from a modal: {{ selected }}</div>
</div>





    <script type="text/ng-template" id="pmtModalContent.html"  data-ng-init="getPayments()">
       
        <div class="modal-header">
            New Payment for {{offender.firstName}} {{offender.lastName}}
        </div>
        <div class="modal-body">
        	<div class="col-md-12">
        	<span data-ng-show="!hide">
        	   <br>
        	   <h3>What are we paying for?</h3>
        	  
        	   <div class="panel-primary">
        	   <div class="content">
       		 <table class="table table-bordered table-striped table-responsive">
	                <thead>
	                    <tr>
	                    <th>
	                            <div class="th">
	                                Due Date
	                             </div>
	                        </th>
	                       
	                        <th>
	                            <div class="th">
	                                Charge 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Status 
	                        </div>
	                        </th>
	                        <th>
	                            <div class="th">
	                                Notes 
	                        </div>
	                        </th>

	                                  </tr> 
	                </thead>
	                <tbody>
	                    <tr data-ng-repeat="wo in payments track by $index" data-ng-click="chooseRow($index)">
	                    <td>{{wo.dueDate | date: 'short'}}</td>
	                   
	                    <td>${{wo.amount | number: '2'}}</td>
	                    <td>{{wo.status}}</td>
	                    <td>{{wo.notes}}</td>
	                    
	                    </tr>

	                  

	                    </tbody>
	                    </table>
	                    </div>
	                   </div>
      
        </span>

        	</div>

        	  <span data-ng-show="hide" >
        	 
        	 <br>
        	  <div class="row">
        	   <div class="col-md-6"> 
        	   <label>Payment Creation Date:</label> {{pmtchosen.created | date: 'MM/dd/yyyy'}}<br>
        	   <label>Due Date: </label> {{pmtchosen.dueDate | date: 'MM/dd/yyyy'}}<br>
        	   <label>Amount Due: </label>  {{pmtchosen.amount | currency}}<br>

        	   

        	   
        	   <br>
        	   </div>

        	    <div class="col-md-6"> 
        	    Work Order ID: {{wochosen._id}}<br>
        	    Service Center: {{serviceCenter.name}}<br>
        	    Address: {{serviceCenter.address}} 
        	   {{serviceCenter.city}}, {{serviceCenter.state}}

        	   

        	   
        	   <br>
        	   </div>
        	   </div>
        	  
        	   </span>
       

        <div class="row">
        <div class="col-md-6"> 
        	    <label>Amount: </label>
        	  <input type="text" data-ng-model="pmtAmount"  id="" class="form-control" placeholder="Amount" >
        	
        	    </div>
        	   

        	   <div class="col-md-6"> 
        	

			<label>Payment Type:</label>
        	  <select class="form-control" data-ng-model="pmtOpt"  data-ng-options="item for item in pmtOpts" ><option value=""></option></select>

        	  </div>
        	  </div>

        	 
        	 
        	 <br>
        	  <div class="row">
        	  


        	    <span data-ng-show="pmtOpt==='Check'" >
        	     <div class="col-md-6"> 
 <label>Check Number: </label>
        	  <input type="text" data-ng-model="checkNum"  id="" class="form-control" placeholder="Check Number" >
        	
        	   </div>
        	  

        	   </span>


        	    </div>
        	   
        	            	     <div data-ng-show="pmtOpt==='Credit Card'" >
        	            	     <br>
        	     	<div class="panel-primary">
        	     	    
        	            	     	 

                        
                          <div class="form-group col-md-4" >
                                <label class="control-label" for="name">Credit Card Number</label>
                                <div class="controls">
                                           <input type="text" data-ng-model="offenderCC" id="offenderEmail" class="form-control" placeholder="Credit Card Number" maxlength="16">

                                </div>
                            </div>

                          <div class="form-group col-md-2" >
                            <label class="control-label" for="name">Expiration Month</label>
                            <div class="controls">
                                    <select data-ng-model="expMonth" class="form-control" name="expMonth" placeholder="Month" ng-options="month for month in months"></select>


                            </div>
                        </div>

                          <div class="form-group col-md-2" >
                            <label class="control-label" for="name">Expiration Year</label>
                            <div class="controls">
                                     <select data-ng-model="expYear" class="form-control" name="expYear" placeholder="Year" ng-options="year for year in expYears"></select>
                            </div>
                        </div>

                          <div class="form-group col-md-2" >
                            <label class="control-label" for="name">CCV Number</label>
                            <div class="controls">
                                      <input type="text" data-ng-model="creditCardCCV" name="creditcardCCV" id="creditcardCCV" class="form-control" placeholder="CCV" >

                            </div>
                        </div>


                        <br>
                   <br>  <a class="btn btn-primary btn-sm" style="color: #fff;" >
				<span class="glyphicon glyphicon-usd" aria-hidden="true"></span> Use Card On-File
			</a>
        	  
        	  </div>
        	  
        	  <br>
        	   </div>


        	   <br>
        	   <div class="row">
        	   <div class="col-md-12">
        	   <label>Payment Notes</label>
        	    <textarea type="text" data-ng-model="payment.notes"  id="notes" class="form-control" placeholder="Notes..." >

        	    </textarea>
        	    </div>
        	   </div>

        <div class="modal-footer">
            <button class="btn btn-primary"  ng-click="makePmt()">Confirm Payment</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </script>



	</div> 
	</div></div>
	     
	    </div>
	</div> 
		
</section>




    <script type="text/ng-template" id="pmtDetailContent.html">
       
        <div class="modal-header">
        <span class="small pull-right">
            <label>Logged In-As</label>
        	 
        	    {{authentication.user.displayName}}
        	    </span>

        	    <center>

        	      <br>
        	      <h2>Payment Detail</h2>
        	      </center>
        </div>
        <div class="modal-body">
      	<label>Status:</label>
      	{{payment.status}}
      	<br><br>
      	{{payment}}
      	<br><br>

      	Amount: <input type="text" ng-model="payment.amount"><br>
      	Due Date: <input type="text" ng-model="payment.dueDate">
        
 
        	   



        </div>
        <div class="modal-footer">
            <button class="btn btn-primary"  ng-click="ok()">Save Payment</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </script>

	    	
    <script type="text/ng-template" id="checkOutDevice.html">
       
        <div class="modal-header">

            Inventory Device for {{offender.firstName}} {{offender.lastName}}
        </div>
        <div class="modal-body">
      	<p>Please enter the Serial Number of the device that you are installing here</p>        
         <label>Device Serial Number</label>
        	  
        	    <input type="text" data-ng-model="deviceSN" class="form-control" placeholder="Serial Number" >
        	   

<br>
				 <label>Device Notes</label>
        	    <textarea type="text" data-ng-model="deviceNotes"  id="deviceNotes" class="form-control" placeholder="Cracked Screen/Faulty Cord, etc" >

        	    </textarea>
                
        	      


        </div>
        <div class="modal-footer">
            <button class="btn btn-primary" ng-click="deviceCheckout()">Check-Out Device</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </script>



    <script type="text/ng-template" id="setApptModal.html">
       
        <div class="modal-header">

            New Work Order for {{offender.firstName}} {{offender.lastName}}
        </div>

        <div class="modal-body">
    


         <div class="input-group ui-datepicker" ng-click="openCalendar($event)" ng-init="findWorkOrder()">
                    <span class="input-group-addon" ><i class="fa fa-calendar"></i></span>
                    <input type="text" 
                           class="form-control "
                           datepicker-popup="{{format}}"
                           ng-model="dt"
                           is-open="opened"
                           min="minDate"
                           max="'2016-06-22'"
                           datepicker-options="dateOptions"
                           ng-required="true" 
                           close-text="Close"
                           style="width: 65%"
                           name="ApptDate"
                           >
                   
                     


                </div>

                   <div ng-model="mytime" ng-change="changed()" style="display:inline-block;" >
                    <timepicker class="ui-timepicker" hour-step="hstep" minute-step="mstep" show-meridian="ismeridian" ></timepicker>
                </div>  
                

                <br>
                Set the Date and Time for this Appointment
            </div>
             <div class="modal-footer">
            <button class="btn btn-primary" ng-click="schedule()">Set Appointment</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>


</script>



        <script type="text/ng-template" id="agreement.html">
       
        <div class="modal-header">

            <label>Secure Customer Authorization</label>
        </div>
        <div class="modal-body">
        <center>
      <label>Please choose how the customer shall sign the Work Order Authorization. There are three options:</label>
      </center>
      <br/>
      <ul>
      <li>Customer eSigns from their Smartphone/Tablet/Laptop</li>
      <li>Customer eSigns on this machine</li>
      <li>Customer signs on paper, you can print the authorization from here</li>
      </ul>
      <br/>

      <span data-ng-show="showE">
       <label>Email Address</label>
        	    <input type="text" data-ng-model="offender.offenderEmail"  id="emailAddress" class="form-control" placeholder="Email Address" >
        	    <button class="btn btn-info" ng-click="sendingEmail()">Send Authorization</button>
		</span>        
    

        </div>
        <div class="modal-footer">
  			<button class="btn btn-primary" ng-click="showE=true">Send eSign Request</button>
           <button class="btn btn-warning" ng-click="eSignHere()">eSign Here</button>
            <button class="btn btn-info" ng-click="printAuth()">Print Authorization</button>

        </div>
    </script>



    <script type="text/ng-template" id="completeOrder.html">
       
        <div class="modal-header">

            <label>Confirm Work Order Completion</label>
        </div>
        <div class="modal-body">
        <center>
      Now that the work is complete, it is time to bill the customer. Please confirm the Certified Technician who completed the work order below!
      </center>
        
        
        	
<br/><br/>
<label>Certified Technician's Name</label>
        	   <input type="text" data-ng-model="techName"  id="techName" class="form-control" placeholder="Tech Name" >
        	   <br/>

        	    <label>Notes</label>
        	    <textarea type="text" data-ng-model="orderNotes"  id="orderNotes" class="form-control" placeholder="Anything to note?" >

        	    </textarea>
                                <br>
        	    <center>
        	     By confirming completion below, you are certifying that the work order is complete and up to the Budget IID standards. Customer will be charged within 24 hours for this service.
        	     </center>
        	      


        </div>
        <div class="modal-footer">

            <button class="btn btn-primary" ng-click="complete()">Confirm Completion</button>
            <button class="btn btn-warning" ng-click="cancel()">Cancel</button>
        </div>
    </script>



    <div ng-show="selected">Selection from a modal: {{ selected }}</div>
</div>



	</div> 
	</div></div>
	     
	    </div>
	</div> 
		
</section>

